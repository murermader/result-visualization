<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive D3 Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            pointer-events: none;
            font-size: 12px;
        }
    </style>
</head>
<body>
<svg width="800" height="500"></svg>
<div class="tooltip" style="opacity: 0;"></div>

<script>
    // Set up dimensions
    const width = 800;
    const height = 500;

    // Create an SVG canvas
    const svg = d3.select("svg")
        .attr("width", width)
        .attr("height", height);

    // Set up map projection (Mercator)
    const projection = d3.geoMercator()
        .scale(100)
        .translate([width / 2, height / 2]);

    const path = d3.geoPath().projection(projection);

    // Create a group to hold the map (will make zooming easier)
    const g = svg.append("g");

    // Add zoom behavior
    const zoom = d3.zoom()
        .scaleExtent([1, 100])  // Limits zoom level (1x to 8x)
        .on("zoom", (event) => {
            g.attr("transform", event.transform);  // Apply zoom and pan transformation
        });

    svg.call(zoom);  // Call zoom behavior on the SVG

    // Load GeoJSON data (World map for example)
    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then(function(geojson) {

        // Draw the base map
        g.selectAll("path")
            .data(geojson.features)
            .enter()
            .append("path")
            .attr("d", path)
            .attr("fill", "#b8b8b8")
            .attr("stroke", "black")
            .on("mouseover", function(event, d) {
                d3.select(this)
                    .attr("fill", "orange");  // Highlight the hovered country
            })
            .on("mouseout", function(event, d) {
                d3.select(this)
                    .attr("fill", "#b8b8b8");  // Reset the fill color
            })
            .on("click", function(event, d) {
                alert(`You clicked on: ${d.properties.name}`);  // Display country name on click
            });

        // Example: Add interactive circles (custom elements) at specific lat/lon locations
        const cities = [
            { name: "New York", coords: [-74.006, 40.7128] },
            { name: "London", coords: [-0.1276, 51.5074] },
            { name: "Tokyo", coords: [139.6917, 35.6895] }
        ];

        const tooltip = d3.select(".tooltip");

        g.selectAll("circle")
            .data(cities)
            .enter()
            .append("circle")
            .attr("cx", d => projection(d.coords)[0])
            .attr("cy", d => projection(d.coords)[1])
            .attr("r", 5)
            .attr("fill", "red")
            .on("mouseover", function(event, d) {
                tooltip.style("opacity", 1)
                    .style("left", (event.pageX + 5) + "px")
                    .style("top", (event.pageY - 5) + "px")
                    .html(d.name);
                d3.select(this).attr("r", 8);  // Make circle larger on hover
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
                d3.select(this).attr("r", 5);  // Reset circle size
            })
            .on("click", function(event, d) {
                alert(`You clicked on: ${d.name}`);  // Display city name on click
            });
    });
</script>
</body>
</html>
