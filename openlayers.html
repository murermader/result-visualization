<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive OpenLayers Map with Hover</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol/ol.css" type="text/css">
    <style>
        #map {
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
<h2>Interactive Map with GeoJSON Layer and Hover Effect</h2>
<div id="map"></div>

<!-- OpenLayers JS -->
<script src="https://cdn.jsdelivr.net/npm/ol/dist/ol.js"></script>
<!-- D3 JS -->
<script src="https://d3js.org/d3.v6.min.js"></script>

<script type="module">
    import uas from "url:./data/switzerland_uas_4326.geojson"

    // Initialize OpenLayers Map
    const map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([0, 0]),
            zoom: 2
        })
    });

    // Load GeoJSON using D3
    d3.json(uas).then(function(geojsonData) {
        // Convert GeoJSON to OpenLayers features
        const format = new ol.format.GeoJSON();
        const features = format.readFeatures(geojsonData, {
            featureProjection: 'EPSG:3857'  // Project to match map projection
        });

        // Create vector source and layer
        const vectorSource = new ol.source.Vector({
            features: features
        });

        const vectorLayer = new ol.layer.Vector({
            source: vectorSource,
            style: function(feature) {
                // Default style for the features
                return new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(0, 150, 255, 0.6)'  // Light blue default color
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#000000',
                        width: 1
                    })
                });
            }
        });

        // Add the vector layer to the map
        map.addLayer(vectorLayer);

        // Create a variable to store the currently hovered feature
        let lastHoveredFeature = null;

        // Add an event listener for pointer move (mouse hover)
        map.on('pointermove', function(event) {
            // Get the feature at the pointer location
            map.forEachFeatureAtPixel(event.pixel, function(feature) {
                if (lastHoveredFeature !== feature) {
                    if (lastHoveredFeature) {
                        // Reset the style of the previously hovered feature
                        lastHoveredFeature.setStyle(null);  // Reset to default style
                    }

                    // Change the style of the new hovered feature
                    feature.setStyle(new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: 'rgba(255, 165, 0, 0.6)'  // Orange hover color
                        }),
                        stroke: new ol.style.Stroke({
                            color: '#FF4500',
                            width: 2
                        })
                    }));

                    // Update the last hovered feature
                    lastHoveredFeature = feature;
                }
            });

            // If no feature is found at the pixel, reset the last hovered feature
            if (!map.hasFeatureAtPixel(event.pixel)) {
                if (lastHoveredFeature) {
                    lastHoveredFeature.setStyle(null);
                    lastHoveredFeature = null;
                }
            }
        });
    });
</script>
</body>
</html>
